---
- name: Wait for Kubernetes API to be available
  become: true
  ansible.builtin.wait_for:
    host: localhost
    port: 6443
    timeout: 300
    delay: 10

- name: Add Kubernetes Dashboard Helm repository
  become: true
  ansible.builtin.shell: helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/

- name: Install Kubernetes Dashboard
  become: true
  ansible.builtin.shell: helm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard --create-namespace --namespace kubernetes-dashboard

- name: Enable Kubernetes Dashboard
  become: true
  ansible.builtin.shell: kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443